/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package frame;

import java.io.FileInputStream;

import java.io.IOException;
import java.io.ObjectInputStream;

import java.util.ArrayList;
import javax.swing.JOptionPane;
import static javax.swing.WindowConstants.HIDE_ON_CLOSE;
import code.ManageUser;
import code.User;

public class Login extends javax.swing.JFrame {

    private ManageUser manageOwner = new ManageUser();

    public Login() {

        initComponents();
        this.setLocationRelativeTo(null);
        setDefaultCloseOperation(HIDE_ON_CLOSE);

        loadOwners();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jLabel1 = new javax.swing.JLabel();
        helloLabel2 = new javax.swing.JLabel();
        jPanel2 = new javax.swing.JPanel();
        helloLabel = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        helloLabel1 = new javax.swing.JLabel();
        signInIcon = new javax.swing.JLabel();
        jPanel3 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        usernameTF = new javax.swing.JTextField();
        passwordTF = new javax.swing.JPasswordField();
        showRBT = new javax.swing.JRadioButton();
        loginBT = new javax.swing.JButton();
        usernameLabel = new javax.swing.JLabel();
        passwordLabel = new javax.swing.JLabel();
        signInLabel = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        registerBT = new javax.swing.JButton();

        helloLabel2.setFont(new java.awt.Font("Segoe UI Symbol", 1, 16)); // NOI18N
        helloLabel2.setForeground(new java.awt.Color(255, 255, 255));
        helloLabel2.setText("and start journey with us !");

        jPanel2.setBackground(new java.awt.Color(181, 181, 246));
        jPanel2.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        helloLabel.setBackground(new java.awt.Color(255, 255, 255));
        helloLabel.setFont(new java.awt.Font("Arial", 1, 36)); // NOI18N
        helloLabel.setForeground(new java.awt.Color(255, 255, 255));
        helloLabel.setText("Hello, Friend!");
        jPanel2.add(helloLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(70, 30, -1, 55));

        jLabel4.setForeground(new java.awt.Color(255, 255, 255));
        jLabel4.setText("____________________________________________________");
        jPanel2.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 90, -1, -1));

        helloLabel1.setFont(new java.awt.Font("Segoe UI Symbol", 1, 16)); // NOI18N
        helloLabel1.setForeground(new java.awt.Color(255, 255, 255));
        helloLabel1.setText("Please register your account ");
        jPanel2.add(helloLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(70, 130, -1, -1));
        jPanel2.add(signInIcon, new org.netbeans.lib.awtextra.AbsoluteConstraints(100, 210, 148, -1));

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Login");
        setBackground(new java.awt.Color(255, 255, 255));
        getContentPane().setLayout(new java.awt.GridBagLayout());

        jPanel3.setBackground(new java.awt.Color(255, 255, 255));
        jPanel3.setLayout(new java.awt.GridBagLayout());

        jPanel1.setBackground(new java.awt.Color(227, 218, 236));
        jPanel1.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        usernameTF.setCursor(new java.awt.Cursor(java.awt.Cursor.TEXT_CURSOR));
        usernameTF.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                usernameTFActionPerformed(evt);
            }
        });
        jPanel1.add(usernameTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 130, 360, 34));
        jPanel1.add(passwordTF, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 240, 360, 36));

        showRBT.setFont(new java.awt.Font("Segoe UI Semibold", 0, 14)); // NOI18N
        showRBT.setForeground(new java.awt.Color(139, 139, 221));
        showRBT.setText("Show/hide password");
        showRBT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                showRBTActionPerformed(evt);
            }
        });
        jPanel1.add(showRBT, new org.netbeans.lib.awtextra.AbsoluteConstraints(55, 288, -1, -1));

        loginBT.setBackground(new java.awt.Color(153, 153, 255));
        loginBT.setFont(new java.awt.Font("Segoe UI Symbol", 1, 14)); // NOI18N
        loginBT.setForeground(new java.awt.Color(255, 255, 255));
        loginBT.setText("Login");
        loginBT.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        loginBT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                loginBTActionPerformed(evt);
            }
        });
        jPanel1.add(loginBT, new org.netbeans.lib.awtextra.AbsoluteConstraints(290, 320, 130, 40));

        usernameLabel.setFont(new java.awt.Font("Segoe UI Symbol", 1, 16)); // NOI18N
        usernameLabel.setForeground(new java.awt.Color(139, 139, 221));
        usernameLabel.setText("Username:");
        jPanel1.add(usernameLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 90, 85, -1));

        passwordLabel.setFont(new java.awt.Font("Segoe UI Symbol", 1, 16)); // NOI18N
        passwordLabel.setForeground(new java.awt.Color(139, 139, 221));
        passwordLabel.setText("Password:");
        jPanel1.add(passwordLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 200, 85, -1));

        signInLabel.setBackground(new java.awt.Color(255, 255, 255));
        signInLabel.setFont(new java.awt.Font("Arial", 1, 36)); // NOI18N
        signInLabel.setForeground(new java.awt.Color(153, 153, 255));
        signInLabel.setText("Login");
        jPanel1.add(signInLabel, new org.netbeans.lib.awtextra.AbsoluteConstraints(190, 10, -1, 54));

        jLabel2.setForeground(new java.awt.Color(255, 255, 255));
        jLabel2.setText("_______________________________________________________________");
        jPanel1.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 60, 330, -1));

        registerBT.setBackground(new java.awt.Color(153, 153, 255));
        registerBT.setFont(new java.awt.Font("Segoe UI Symbol", 1, 14)); // NOI18N
        registerBT.setForeground(new java.awt.Color(255, 255, 255));
        registerBT.setText("Signup");
        registerBT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                registerBTActionPerformed(evt);
            }
        });
        jPanel1.add(registerBT, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 320, 130, 40));

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.ipadx = 45;
        gridBagConstraints.ipady = 19;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(6, 6, 6, 0);
        jPanel3.add(jPanel1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        getContentPane().add(jPanel3, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents


    private void loadOwners() {
        try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream("User.Dat"))) {
            manageOwner.setListUser((ArrayList<User>) ois.readObject());
        } catch (IOException | ClassNotFoundException e) {
            JOptionPane.showMessageDialog(this, "Error loading users.");
        }
    }


    private void usernameTFActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_usernameTFActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_usernameTFActionPerformed

    private void loginBTActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_loginBTActionPerformed
        if (usernameTF.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Enter username!");
            usernameTF.requestFocus();
            return;
        } else if (usernameTF.getText().contains(" ")) {
            JOptionPane.showMessageDialog(this, "Invalid username!");
            usernameTF.requestFocus();
            return;
        } else if (passwordTF.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Enter password!");
            passwordTF.requestFocus();
            return;
        } else {
            if (checkUsername()) {
                if (checkPassword()) {
                    JOptionPane.showMessageDialog(this, "Welcome to our app");
                    new Home().setVisible(true);
                    this.setVisible(false);
                } else {
                    JOptionPane.showMessageDialog(this, "Wrong Password");
                    passwordTF.requestFocus();
                    return;
                }
            } else {
                JOptionPane.showMessageDialog(this, "Wrong Username");
                usernameTF.requestFocus();
                return;
            }
        }
    }//GEN-LAST:event_loginBTActionPerformed

    private void registerBTActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_registerBTActionPerformed
        new Signup(manageOwner).setVisible(true);
    }//GEN-LAST:event_registerBTActionPerformed

    private void showRBTActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_showRBTActionPerformed
        if (showRBT.isSelected()) {
            passwordTF.setEchoChar((char) 0);
        } else {
            passwordTF.setEchoChar('*');
        }
    }//GEN-LAST:event_showRBTActionPerformed

    private boolean checkUsername() {
        for (User owner : manageOwner.getListUser()) {
            if (owner.getUsername().equals(usernameTF.getText().trim())) {
                return true;
            }
        }
        return false;
    }

    private boolean checkPassword() {
        for (User owner : manageOwner.getListUser()) {
            if (owner.getUsername().equals(usernameTF.getText().trim()) && owner.getPassword().equals(passwordTF.getText().trim())) {
                return true;
            }
        }
        return false;
    }

    /**
     * @param args the command line arguments
     */

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel helloLabel;
    private javax.swing.JLabel helloLabel1;
    private javax.swing.JLabel helloLabel2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JButton loginBT;
    private javax.swing.JLabel passwordLabel;
    private javax.swing.JPasswordField passwordTF;
    private javax.swing.JButton registerBT;
    private javax.swing.JRadioButton showRBT;
    private javax.swing.JLabel signInIcon;
    private javax.swing.JLabel signInLabel;
    private javax.swing.JLabel usernameLabel;
    private javax.swing.JTextField usernameTF;
    // End of variables declaration//GEN-END:variables
}
